<div class="flex flex-col gap-6">

    <!-- Map Controls/Legend -->
    <div
        class="flex flex-wrap items-center justify-between gap-4 bg-white dark:bg-slate-800 p-4 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700">
        <div class="flex items-center gap-6 text-sm font-medium">
            <div class="flex items-center gap-2">
                <div class="w-5 h-5 rounded-full border-2 border-primary/50 bg-white dark:bg-slate-700"></div>
                <span class="text-slate-600 dark:text-slate-300">Disponible</span>
            </div>
            <div class="flex items-center gap-2">
                <div class="w-5 h-5 rounded-full bg-primary shadow-sm shadow-primary/30"></div>
                <span class="text-slate-600 dark:text-slate-300">Sélectionné</span>
            </div>
            <div class="flex items-center gap-2">
                <div class="w-5 h-5 rounded-full bg-slate-200 dark:bg-slate-600 cursor-not-allowed"></div>
                <span class="text-slate-400 dark:text-slate-500">Vendu</span>
            </div>
        </div>
    </div>

    <!-- Interactive Map Container -->
    <div
        class="relative w-full h-[600px] bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden group cursor-grab active:cursor-grabbing">

        <!-- Stage Indicator -->
        <div
            class="absolute top-8 left-1/2 -translate-x-1/2 w-3/4 h-16 bg-slate-100 dark:bg-slate-700 rounded-b-[4rem] flex items-center justify-center border-b-4 border-slate-200 dark:border-slate-600 z-10">
            <span class="text-slate-400 dark:text-slate-500 font-bold tracking-[0.2em] uppercase text-sm">
                Scène
            </span>
        </div>

        <!-- Seats Visualization -->
        <div class="absolute top-32 left-1/2 -translate-x-1/2 flex flex-col gap-12 scale-90 origin-top">

            <!-- Dynamic Sections -->
            @for (section of sections(); track section) {
            @if (section === 'Fosse Or') {
            <!-- Fosse Or Section -->
            <div class="flex flex-col items-center gap-2">
                <div class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1">
                    {{ section }} - {{ getPriceForSection(section) }}€
                </div>
                @for (row of fosseOrRows(); track $index) {
                <div class="flex gap-2">
                    @for (seat of row; track seat.id) {
                    <button [disabled]="seat.status === 'sold'" [class.border-2]="seat.status === 'available'"
                        [class.border-primary/50]="seat.status === 'available'"
                        [class.bg-white]="seat.status === 'available'"
                        [class.dark:bg-slate-700]="seat.status === 'available'"
                        [class.hover:bg-primary/20]="seat.status === 'available'"
                        [class.bg-primary]="seat.status === 'selected'" [class.shadow-lg]="seat.status === 'selected'"
                        [class.shadow-primary/40]="seat.status === 'selected'"
                        [class.ring-2]="seat.status === 'selected'" [class.ring-offset-2]="seat.status === 'selected'"
                        [class.ring-primary]="seat.status === 'selected'"
                        [class.ring-offset-white]="seat.status === 'selected'"
                        [class.dark:ring-offset-slate-800]="seat.status === 'selected'"
                        [class.bg-slate-200]="seat.status === 'sold'" [class.dark:bg-slate-600]="seat.status === 'sold'"
                        [class.cursor-not-allowed]="seat.status === 'sold'" (click)="onSeatClick(seat)"
                        [title]="section + ' - Rang ' + seat.row + ' - Place ' + seat.number"
                        class="w-5 h-5 rounded-full transition-all"></button>
                    }
                </div>
                }
            </div>
            } @else if (section === 'Catégorie 1') {
            <!-- Catégorie 1 Section -->
            <div class="flex flex-col items-center gap-2 mt-4">
                <div class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1">
                    {{ section }} - {{ getPriceForSection(section) }}€
                </div>
                <div class="flex gap-3 items-end">
                    <!-- Left Section -->
                    <div class="flex flex-col gap-2 rotate-6 transform translate-y-2">
                        @for (row of cat1LeftRows(); track $index) {
                        <div class="flex gap-2">
                            @for (seat of row; track seat.id) {
                            <button [disabled]="seat.status === 'sold'" [class.border-2]="seat.status === 'available'"
                                [class.border-purple-400/50]="seat.status === 'available'"
                                [class.hover:bg-purple-400/20]="seat.status === 'available'"
                                [class.bg-primary]="seat.status === 'selected'"
                                [class.shadow-lg]="seat.status === 'selected'"
                                [class.bg-slate-200]="seat.status === 'sold'"
                                [class.dark:bg-slate-600]="seat.status === 'sold'" (click)="onSeatClick(seat)"
                                [title]="section + ' - Rang ' + seat.row + ' - Place ' + seat.number"
                                class="w-5 h-5 rounded-full transition-all"></button>
                            }
                        </div>
                        }
                    </div>

                    <!-- Center Section -->
                    <div class="flex flex-col gap-2">
                        @for (row of cat1CenterRows(); track $index) {
                        <div class="flex gap-2">
                            @for (seat of row; track seat.id) {
                            <button [disabled]="seat.status === 'sold'" [class.border-2]="seat.status === 'available'"
                                [class.border-purple-400/50]="seat.status === 'available'"
                                [class.hover:bg-purple-400/20]="seat.status === 'available'"
                                [class.bg-primary]="seat.status === 'selected'"
                                [class.shadow-lg]="seat.status === 'selected'"
                                [class.bg-slate-200]="seat.status === 'sold'"
                                [class.dark:bg-slate-600]="seat.status === 'sold'" (click)="onSeatClick(seat)"
                                [title]="section + ' - Rang ' + seat.row + ' - Place ' + seat.number"
                                class="w-5 h-5 rounded-full transition-all"></button>
                            }
                        </div>
                        }
                    </div>

                    <!-- Right Section -->
                    <div class="flex flex-col gap-2 -rotate-6 transform translate-y-2">
                        @for (row of cat1RightRows(); track $index) {
                        <div class="flex gap-2">
                            @for (seat of row; track seat.id) {
                            <button [disabled]="seat.status === 'sold'" [class.border-2]="seat.status === 'available'"
                                [class.border-purple-400/50]="seat.status === 'available'"
                                [class.hover:bg-purple-400/20]="seat.status === 'available'"
                                [class.bg-primary]="seat.status === 'selected'"
                                [class.shadow-lg]="seat.status === 'selected'"
                                [class.bg-slate-200]="seat.status === 'sold'"
                                [class.dark:bg-slate-600]="seat.status === 'sold'" (click)="onSeatClick(seat)"
                                [title]="section + ' - Rang ' + seat.row + ' - Place ' + seat.number"
                                class="w-5 h-5 rounded-full transition-all"></button>
                            }
                        </div>
                        }
                    </div>
                </div>
            </div>
            } @else if (section === 'Balcon') {
            <!-- Balcon Section -->
            <div class="flex flex-col items-center gap-2 mt-8 opacity-70 hover:opacity-100 transition-opacity">
                <div class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1">
                    {{ section }} - {{ getPriceForSection(section) }}€
                </div>
                @for (row of balconRows(); track $index) {
                <div class="flex gap-2 justify-center">
                    @for (seat of row; track seat.id) {
                    <button [disabled]="seat.status === 'sold'" [class.border-2]="seat.status === 'available'"
                        [class.border-blue-400/50]="seat.status === 'available'"
                        [class.hover:bg-blue-400/20]="seat.status === 'available'"
                        [class.bg-primary]="seat.status === 'selected'" [class.shadow-lg]="seat.status === 'selected'"
                        [class.bg-slate-200]="seat.status === 'sold'" [class.dark:bg-slate-600]="seat.status === 'sold'"
                        (click)="onSeatClick(seat)"
                        [title]="section + ' - Rang ' + seat.row + ' - Place ' + seat.number"
                        class="w-5 h-5 rounded-full transition-all"></button>
                    }
                </div>
                }
            </div>
            <div class="flex gap-1 justify-center">
                <div class="flex gap-1 bg-slate-100 dark:bg-slate-700 p-2 rounded-full px-4">
                    <span class="text-xs text-slate-400">Section B1</span>
                    <div class="w-2 h-2 rounded-full bg-green-400 mx-1 self-center"></div>
                    <span class="text-xs text-green-600 dark:text-green-400 font-bold">Disponible</span>
                </div>
                <div class="flex gap-1 bg-slate-100 dark:bg-slate-700 p-2 rounded-full px-4">
                    <span class="text-xs text-slate-400">Section B2</span>
                    <div class="w-2 h-2 rounded-full bg-slate-400 mx-1 self-center"></div>
                    <span class="text-xs text-slate-400 font-bold">Complet</span>
                </div>
                <div class="flex gap-1 bg-slate-100 dark:bg-slate-700 p-2 rounded-full px-4">
                    <span class="text-xs text-slate-400">Section B3</span>
                    <div class="w-2 h-2 rounded-full bg-green-400 mx-1 self-center"></div>
                    <span class="text-xs text-green-600 dark:text-green-400 font-bold">Disponible</span>
                </div>
            </div>
            }
            }
        </div>
    </div>
</div>