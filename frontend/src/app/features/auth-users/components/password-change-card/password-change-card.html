<div class="bg-white dark:bg-[#1a1d2d] rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm overflow-hidden">
    <!-- Messages -->
    @if (error()) {
        <div class="alert alert-error p-4">
            <span class="material-symbols-outlined">error</span>
            {{ error() }}
        </div>
    }
    @if (successMessage()) {
        <div class="alert alert-success p-4">
            <span class="material-symbols-outlined">check_circle</span>
            {{ successMessage() }}
        </div>
    }

    <div class="p-6 border-b border-slate-100 dark:border-slate-800 flex items-center gap-3">
        <span class="material-symbols-outlined text-primary">key</span>
        <h3 class="text-lg font-bold text-slate-900 dark:text-white">Mot de passe</h3>
    </div>

    <form (ngSubmit)="onSubmit()" class="p-6 flex flex-col gap-6">
        <!-- Current Password -->
        <div class="flex flex-col gap-2">
            <label class="text-xs font-bold text-slate-400 uppercase tracking-wider">Mot de passe actuel</label>
            <div class="relative">
                <input 
                    [ngModel]="currentPassword()" 
                    (ngModelChange)="currentPassword.set($event)"
                    name="currentPassword"
                    [type]="showPasswords() ? 'text' : 'password'"
                    class="w-full px-3 py-2 pr-10 border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all" 
                    placeholder="••••••••" 
                    [disabled]="isLoading()"/>
                <button 
                    type="button"
                    (click)="togglePasswordVisibility()"
                    class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-500 hover:text-slate-700 dark:hover:text-slate-300">
                    <span class="material-symbols-outlined text-[18px]">
                        {{ showPasswords() ? 'visibility' : 'visibility_off' }}
                    </span>
                </button>
            </div>
            @if (!currentPassword()) {
                <p class="text-xs text-slate-500">Requis pour confirmer votre identité</p>
            }
        </div>

        <!-- New Password -->
        <div class="flex flex-col gap-2">
            <label class="text-xs font-bold text-slate-400 uppercase tracking-wider">Nouveau mot de passe</label>
            <div class="relative">
                <input 
                    [ngModel]="newPassword()" 
                    (ngModelChange)="newPassword.set($event)"
                    name="newPassword"
                    [type]="showPasswords() ? 'text' : 'password'"
                    class="w-full px-3 py-2 pr-10 border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all" 
                    placeholder="Minimum 8 caractères" 
                    [disabled]="isLoading()"/>
                <button 
                    type="button"
                    (click)="togglePasswordVisibility()"
                    class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-500 hover:text-slate-700 dark:hover:text-slate-300">
                    <span class="material-symbols-outlined text-[18px]">
                        {{ showPasswords() ? 'visibility' : 'visibility_off' }}
                    </span>
                </button>
            </div>
            <div class="flex items-center gap-2 text-xs">
                @if (newPassword().length > 0 && newPassword().length < 8) {
                    <span class="material-symbols-outlined text-red-500 text-[16px]">close</span>
                    <span class="text-red-500">Minimum 8 caractères requis</span>
                } @else if (passwordValid()) {
                    <span class="material-symbols-outlined text-green-500 text-[16px]">check</span>
                    <span class="text-green-500">Mot de passe valide</span>
                }
            </div>
        </div>

        <!-- Confirm Password -->
        <div class="flex flex-col gap-2">
            <label class="text-xs font-bold text-slate-400 uppercase tracking-wider">Confirmer le mot de passe</label>
            <div class="relative">
                <input 
                    [ngModel]="confirmPassword()" 
                    (ngModelChange)="confirmPassword.set($event)"
                    name="confirmPassword"
                    [type]="showPasswords() ? 'text' : 'password'"
                    class="w-full px-3 py-2 pr-10 border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all" 
                    placeholder="••••••••"
                    [disabled]="isLoading()"/>
                <button 
                    type="button"
                    (click)="togglePasswordVisibility()"
                    class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-500 hover:text-slate-700 dark:hover:text-slate-300">
                    <span class="material-symbols-outlined text-[18px]">
                        {{ showPasswords() ? 'visibility' : 'visibility_off' }}
                    </span>
                </button>
            </div>
            @if (confirmPassword().length > 0 && !passwordsMatch()) {
                <p class="text-xs text-red-500 flex items-center gap-1">
                    <span class="material-symbols-outlined text-[16px]">close</span>
                    Les mots de passe ne correspondent pas
                </p>
            } @else if (passwordsMatch() && confirmPassword().length > 0) {
                <p class="text-xs text-green-500 flex items-center gap-1">
                    <span class="material-symbols-outlined text-[16px]">check</span>
                    Les mots de passe correspondent
                </p>
            }
        </div>

        <!-- Submit Button -->
        <div class="pt-6 border-t border-slate-100 dark:border-slate-800">
            <button 
                type="submit"
                [disabled]="!formValid() || isLoading()"
                class="w-full px-6 py-3 bg-primary text-white font-bold rounded-lg hover:opacity-90 transition-all uppercase text-xs tracking-widest shadow-md disabled:opacity-50 disabled:cursor-not-allowed">
                {{ isLoading() ? 'Changement en cours...' : 'Mettre à jour le mot de passe' }}
            </button>
        </div>
    </form>
</div>
